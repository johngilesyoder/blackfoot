jQuery(document).ready(function($){0!==$(".envira-helper-needed").length&&$('<div class="envira-meta-helper-overlay" />').prependTo("#envira-gallery"),$(document).on("click",".envira-meta-icon",function(e){e.preventDefault();var a=$(this),t=a.parent(),n=a.next();n.is(":visible")?($(".envira-meta-helper-overlay").remove(),t.removeClass("envira-helper-active")):(0===$(".envira-meta-helper-overlay").length&&$('<div class="envira-meta-helper-overlay" />').prependTo("#envira-gallery"),t.addClass("envira-helper-active"))})}),jQuery(document).ready(function($){$(document).on("change",'input[name="_envira_gallery[type]"]:radio',function(e){var a=$(this);$(".envira-gallery-type-spinner .envira-gallery-spinner").css({display:"inline-block","margin-top":"-1px"});var t={action:"envira_gallery_change_type",post_id:envira_gallery_metabox.id,type:a.val(),nonce:envira_gallery_metabox.change_nonce};$.post(envira_gallery_metabox.ajax,t,function(e){console.log(e),"default"==e.type?$("#envira-gallery-main").html(e.html):$("#envira-gallery-main").html(e.html),$(document).trigger("enviraGalleryType",e),$(".envira-gallery-type-spinner .envira-gallery-spinner").hide()},"json")})}),jQuery(document).ready(function($){$("a.envira-gallery-images-delete").click(function(e){e.preventDefault();var a=confirm(envira_gallery_metabox.remove_multiple);if(!a)return!1;var t=[];$("ul#envira-gallery-output > li.selected").each(function(){t.push($(this).attr("id"))});var n={action:"envira_gallery_remove_images",attachment_ids:t,post_id:envira_gallery_metabox.id,nonce:envira_gallery_metabox.remove_nonce};$.post(envira_gallery_metabox.ajax,n,function(e){$("ul#envira-gallery-output > li.selected").each(function(){$(this).fadeOut("normal",function(){$(this).remove()})}),$("a.envira-gallery-images-delete").fadeOut(),$(".envira-gallery-load-library").attr("data-envira-gallery-offset",0).addClass("has-search").trigger("click")},"json")}),$("#envira-gallery").on("click",".envira-gallery-remove-image",function(e){e.preventDefault();var a=confirm(envira_gallery_metabox.remove);if(a){var t=$(this).parent().attr("id"),n={action:"envira_gallery_remove_image",attachment_id:t,post_id:envira_gallery_metabox.id,nonce:envira_gallery_metabox.remove_nonce};$.post(envira_gallery_metabox.ajax,n,function(e){$("#"+t).fadeOut("normal",function(){$(this).remove(),$(".envira-gallery-load-library").attr("data-envira-gallery-offset",0).addClass("has-search").trigger("click")})},"json")}})}),jQuery(document).ready(function($){var e=[];$("#envira-gallery").on("click.enviraModify",".envira-gallery-modify-image",function(a){a.preventDefault();var n=$(this).parent().data("envira-gallery-image"),i="envira-gallery-meta-"+n;e=[],$("ul#envira-gallery-output li").each(function(){e.push($(this).data("envira-gallery-image"))}),t(n,i)}),$(document).on("click","button.left, button.right",function(e){e.preventDefault(),n();var a=$(this).attr("data-attachment-id"),i="envira-gallery-meta-"+a;t(a,i)});var a,t=function(t,i){a=$("#"+i).appendTo("body"),$(a).show(),$("button.left",$(a)).removeClass("disabled"),$("button.right",$(a)).removeClass("disabled");for(var r=-1,l=0;l<e.length;l++)if(e[l]==t){r=l;break}0==r?($("button.left",$(a)).addClass("disabled"),$("button.left",$(a)).attr("data-attachment-id",""),e.length>1?($("button.right",$(a)).removeClass("disabled"),$("button.right",$(a)).attr("data-attachment-id",e[r+1])):($("button.right",$(a)).addClass("disabled"),$("button.right",$(a)).attr("data-attachment-id",""))):r==e.length-1?($("button.left",$(a)).removeClass("disabled"),$("button.left",$(a)).attr("data-attachment-id",e[r-1]),$("button.right",$(a)).addClass("disabled"),$("button.right",$(a)).attr("data-attachment-id","")):($("button.left",$(a)).removeClass("disabled"),$("button.left",$(a)).attr("data-attachment-id",e[r-1]),$("button.right",$(a)).removeClass("disabled"),$("button.right",$(a)).attr("data-attachment-id",e[r+1])),$(document).on("click.enviraIframe",".media-modal-close, .media-modal-backdrop",function(e){e.preventDefault(),n()}),$(document).on("keydown.enviraIframe",function(e){27==e.keyCode&&n()})},n=function(){var e=$(a).attr("id"),t=e.split("-"),n=t[t.length-1];$("#"+e).appendTo("#"+n).hide(),envira_main_frame=!1,$(document).off("click.enviraLink")},i;$("div.media-modal-content div.query-results").hide(),$(document).on("keyup","div.media-modal-content input#wp-link-search",function(){var e=this;window.clearTimeout(i),i=window.setTimeout(function(){wpLink.searchInternalLinks.call(e)},500)}),$(document).on("click","div.media-modal-content div.query-results li",function(e){var t=$("input[type=hidden]",$(this)).val(),n=$(a).attr("id"),i=n.split("-"),r=i[i.length-1];$("input#envira-gallery-link-"+r).val(t),$(this).parent().html("").parent().hide()}),$("div.media-modal-content input#wp-link-search").change(function(){""==$(this).val()&&$(".query-results ul").html("")}),$(document).on("click","div.media-modal-content input#wp-link-search",function(){var e=this;window.clearTimeout(i),i=window.setTimeout(function(){""==$(e).val()&&$(".query-results ul").html("").parent().hide()},500)}),$(document).on("click",".envira-gallery-meta-submit",function(e){e.preventDefault();var a=$(this),t=a.text(),n=a.data("envira-gallery-item"),i="envira-gallery-meta-"+n,r={},l=$("span.settings-save-status span.spinner"),o=$("span.settings-save-status span.saved");a.text(envira_gallery_metabox.saving),a.attr("disabled","disabled"),$(l).show(),r.caption=$("#envira-gallery-meta-table-"+n).find('textarea[name="_envira_gallery[meta_caption]"]').val(),$("#envira-gallery-meta-table-"+n).find(":input").not(".ed_button").each(function(e,a){$(this).data("envira-meta")&&(r[$(this).data("envira-meta")]=$(this).val(),"checkbox"==$(this).attr("type")&&($(this).attr("checked")?r[$(this).data("envira-meta")]=$(this).val():r[$(this).data("envira-meta")]=0))});var d={action:"envira_gallery_save_meta",nonce:envira_gallery_metabox.save_nonce,attach_id:n,post_id:envira_gallery_metabox.id,meta:r};$.post(envira_gallery_metabox.ajax,d,function(e){a.text(t),a.attr("disabled",!1),$(l).fadeOut("slow",function(){$(o).fadeIn("fast",function(){setTimeout(function(){$(o).fadeOut("slow")},500)})})},"json")})}),jQuery(document).ready(function($){$("a.envira-media-library").on("click",function(e){return e.preventDefault(),wp.media.frames.envira?void wp.media.frames.envira.open():(wp.media.frames.envira=wp.media({frame:"post",title:wp.media.view.l10n.insertIntoPost,button:{text:wp.media.view.l10n.insertIntoPost},multiple:!0}),wp.media.frames.envira.on("open",function(){var e=wp.media.frames.envira.state().get("selection");$("ul#envira-gallery-output li").each(function(){var a=wp.media.attachment($(this).attr("id"));e.add(a?[a]:[])})}),wp.media.frames.envira.on("insert",function(){var e=wp.media.frames.envira.state().get("selection").toJSON();$.post(envira_gallery_metabox.ajax,{action:"envira_gallery_insert_images",nonce:envira_gallery_metabox.insert_nonce,post_id:envira_gallery_metabox.id,images:e},function(e){e&&e.success&&($("#envira-gallery-output").html(e.success),$("#envira-gallery-output").find(".wp-editor-wrap").each(function(e,a){var t=$(a).find(".quicktags-toolbar");if(!(t.length>0)){var n=$(a).attr("id").split("-"),i=n.slice(4,-1).join("-");quicktags({id:"envira-gallery-caption-"+i,buttons:"strong,em,link,ul,ol,li,close"}),QTags._buttonsInit()}}),$("#envira-gallery-output").trigger({type:"enviraRefreshed",html:e.success,id:envira_gallery_metabox.id}))},"json")}),wp.media.frames.envira.open(),$("div.media-menu a.media-menu-item:nth-child(2)").addClass("hidden"),void $("div.media-menu a.media-menu-item:nth-child(6)").addClass("hidden"))})}),jQuery(document).ready(function($){var e=$("#envira-gallery-output");e.sortable({containment:"#envira-gallery-output",items:"li",cursor:"move",forcePlaceholderSize:!0,placeholder:"dropzone",update:function(a,t){var n={url:envira_gallery_metabox.ajax,type:"post",async:!0,cache:!1,dataType:"json",data:{action:"envira_gallery_sort_images",order:e.sortable("toArray").toString(),post_id:envira_gallery_metabox.id,nonce:envira_gallery_metabox.sort},success:function(e){},error:function(e,a,t){}};$.ajax(n)}}),$("a.envira-gallery-images-delete").fadeOut(),$("ul#envira-gallery-output").on("click","li.envira-gallery-image > img",function(){var e=$(this).parent();$(e).hasClass("selected")?$(e).removeClass("selected"):$(e).addClass("selected"),$("ul#envira-gallery-output > li.selected").length>0?$("a.envira-gallery-images-delete").fadeIn():$("a.envira-gallery-images-delete").fadeOut()})}),function($){$(function(){if("undefined"!=typeof uploader){$("#envira-gallery .drag-drop-inside").append('<div class="envira-progress-bar"><div></div></div>');var e=$("#envira-gallery .envira-progress-bar"),a=$("#envira-gallery .envira-progress-bar div"),t=$("#envira-gallery-output");uploader.bind("FilesAdded",function(a,t){$(e).fadeIn()}),uploader.bind("UploadProgress",function(e,t){$(a).css({width:e.total.percent+"%"})}),uploader.bind("FileUploaded",function(e,a,n){$.post(envira_gallery_metabox.ajax,{action:"envira_gallery_load_image",nonce:envira_gallery_metabox.load_image,id:n.response,post_id:envira_gallery_metabox.id},function(e){switch(envira_gallery_metabox.media_position){case"before":$(t).prepend(e);break;case"after":default:$(t).append(e)}$(e).find(".wp-editor-container").each(function(e,a){var t=$(a).attr("id").split("-")[4];quicktags({id:"envira-gallery-caption-"+t,buttons:"strong,em,link,ul,ol,li,close"}),QTags._buttonsInit()})},"json")}),uploader.bind("UploadComplete",function(){$(e).fadeOut()}),uploader.bind("Error",function(e,a){$("#envira-gallery-upload-error").html('<div class="error fade"><p>'+a.file.name+": "+a.message+"</p></div>"),e.refresh()})}})}(jQuery);